set -ex

source /var/vcap/packages/golang-1.10-linux/bosh/compile.env

mkdir -p "${BOSH_INSTALL_TARGET}/bin"
mkdir -p "${GOPATH}/src"

mv code.cloudfoundry.org "${GOPATH}/src"
mv github.com "${GOPATH}/src"
mv google.golang.org "${GOPATH}/src"
mv golang.org "${GOPATH}/src"
mv gopkg.in "${GOPATH}/src"

pushd ${GOPATH}/src/code.cloudfoundry.org/routing-api/cmd/routing-api
  go build -o "${BOSH_INSTALL_TARGET}/bin/routing-api" .
popd

rm -rf "${GOPATH}/src" "${GOPATH}/pkg"
